{"remainingRequest":"F:\\code\\WorkSpace\\mindundisloyalty\\node_modules\\thread-loader\\dist\\cjs.js??ref--9-2!F:\\code\\WorkSpace\\mindundisloyalty\\node_modules\\ts-loader\\index.js??ref--9-3!F:\\code\\WorkSpace\\mindundisloyalty\\node_modules\\eslint-loader\\dist\\cjs.js!F:\\code\\WorkSpace\\mindundisloyalty\\src\\main\\webapp\\app\\core\\auth\\account.service.ts","dependencies":[{"path":"F:\\code\\WorkSpace\\mindundisloyalty\\src\\main\\webapp\\app\\core\\auth\\account.service.ts","mtime":1582739355405},{"path":"F:\\code\\WorkSpace\\mindundisloyalty\\node_modules\\angular2-template-loader\\index.js","mtime":1486570058000},{"path":"F:\\code\\WorkSpace\\mindundisloyalty\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\code\\WorkSpace\\mindundisloyalty\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\code\\WorkSpace\\mindundisloyalty\\node_modules\\ts-loader\\index.js","mtime":499162500000},{"path":"F:\\code\\WorkSpace\\mindundisloyalty\\node_modules\\eslint-loader\\dist\\cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICogYXMgdHNsaWJfMSBmcm9tICJ0c2xpYiI7DQp2YXIgX2E7DQppbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7DQppbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnOw0KaW1wb3J0IHsgU3ViamVjdCwgb2YgfSBmcm9tICdyeGpzJzsNCmltcG9ydCB7IHNoYXJlUmVwbGF5LCB0YXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7DQppbXBvcnQgeyBTRVJWRVJfQVBJX1VSTCB9IGZyb20gJ2FwcC9hcHAuY29uc3RhbnRzJzsNCmxldCBBY2NvdW50U2VydmljZSA9IGNsYXNzIEFjY291bnRTZXJ2aWNlIHsNCiAgICBjb25zdHJ1Y3RvcihodHRwKSB7DQogICAgICAgIHRoaXMuaHR0cCA9IGh0dHA7DQogICAgICAgIHRoaXMuYXV0aGVudGljYXRlZCA9IGZhbHNlOw0KICAgICAgICB0aGlzLmF1dGhlbnRpY2F0aW9uU3RhdGUgPSBuZXcgU3ViamVjdCgpOw0KICAgIH0NCiAgICBmZXRjaCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoU0VSVkVSX0FQSV9VUkwgKyAnYXBpL2FjY291bnQnKTsNCiAgICB9DQogICAgc2F2ZShhY2NvdW50KSB7DQogICAgICAgIHJldHVybiB0aGlzLmh0dHAucG9zdChTRVJWRVJfQVBJX1VSTCArICdhcGkvYWNjb3VudCcsIGFjY291bnQpOw0KICAgIH0NCiAgICBhdXRoZW50aWNhdGUoaWRlbnRpdHkpIHsNCiAgICAgICAgdGhpcy51c2VySWRlbnRpdHkgPSBpZGVudGl0eTsNCiAgICAgICAgdGhpcy5hdXRoZW50aWNhdGVkID0gaWRlbnRpdHkgIT09IG51bGw7DQogICAgICAgIHRoaXMuYXV0aGVudGljYXRpb25TdGF0ZS5uZXh0KHRoaXMudXNlcklkZW50aXR5KTsNCiAgICB9DQogICAgaGFzQW55QXV0aG9yaXR5KGF1dGhvcml0aWVzKSB7DQogICAgICAgIGlmICghdGhpcy5hdXRoZW50aWNhdGVkIHx8ICF0aGlzLnVzZXJJZGVudGl0eSB8fCAhdGhpcy51c2VySWRlbnRpdHkuYXV0aG9yaXRpZXMpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoYXV0aG9yaXRpZXMpKSB7DQogICAgICAgICAgICBhdXRob3JpdGllcyA9IFthdXRob3JpdGllc107DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGF1dGhvcml0aWVzLnNvbWUoKGF1dGhvcml0eSkgPT4gdGhpcy51c2VySWRlbnRpdHkuYXV0aG9yaXRpZXMuaW5jbHVkZXMoYXV0aG9yaXR5KSk7DQogICAgfQ0KICAgIGlkZW50aXR5KGZvcmNlKSB7DQogICAgICAgIGlmIChmb3JjZSB8fCAhdGhpcy5hdXRoZW50aWNhdGVkKSB7DQogICAgICAgICAgICB0aGlzLmFjY291bnRDYWNoZSQgPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIGlmICghdGhpcy5hY2NvdW50Q2FjaGUkKSB7DQogICAgICAgICAgICB0aGlzLmFjY291bnRDYWNoZSQgPSB0aGlzLmZldGNoKCkucGlwZShjYXRjaEVycm9yKCgpID0+IHsNCiAgICAgICAgICAgICAgICByZXR1cm4gb2YobnVsbCk7DQogICAgICAgICAgICB9KSwgdGFwKGFjY291bnQgPT4gew0KICAgICAgICAgICAgICAgIGlmIChhY2NvdW50KSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMudXNlcklkZW50aXR5ID0gYWNjb3VudDsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRoZW50aWNhdGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMudXNlcklkZW50aXR5ID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRoZW50aWNhdGVkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRoaXMuYXV0aGVudGljYXRpb25TdGF0ZS5uZXh0KHRoaXMudXNlcklkZW50aXR5KTsNCiAgICAgICAgICAgIH0pLCBzaGFyZVJlcGxheSgpKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50Q2FjaGUkOw0KICAgIH0NCiAgICBpc0F1dGhlbnRpY2F0ZWQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmF1dGhlbnRpY2F0ZWQ7DQogICAgfQ0KICAgIGlzSWRlbnRpdHlSZXNvbHZlZCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMudXNlcklkZW50aXR5ICE9PSB1bmRlZmluZWQ7DQogICAgfQ0KICAgIGdldEF1dGhlbnRpY2F0aW9uU3RhdGUoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmF1dGhlbnRpY2F0aW9uU3RhdGUuYXNPYnNlcnZhYmxlKCk7DQogICAgfQ0KICAgIGdldEltYWdlVXJsKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5pc0lkZW50aXR5UmVzb2x2ZWQoKSA/IHRoaXMudXNlcklkZW50aXR5LmltYWdlVXJsIDogbnVsbDsNCiAgICB9DQp9Ow0KQWNjb3VudFNlcnZpY2UgPSB0c2xpYl8xLl9fZGVjb3JhdGUoWw0KICAgIEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSksDQogICAgdHNsaWJfMS5fX21ldGFkYXRhKCJkZXNpZ246cGFyYW10eXBlcyIsIFt0eXBlb2YgKF9hID0gdHlwZW9mIEh0dHBDbGllbnQgIT09ICJ1bmRlZmluZWQiICYmIEh0dHBDbGllbnQpID09PSAiZnVuY3Rpb24iID8gX2EgOiBPYmplY3RdKQ0KXSwgQWNjb3VudFNlcnZpY2UpOw0KZXhwb3J0IHsgQWNjb3VudFNlcnZpY2UgfTsNCg=="},{"version":3,"file":"F:\\code\\WorkSpace\\mindundisloyalty\\src\\main\\webapp\\app\\core\\auth\\account.service.ts","sourceRoot":"","sources":["F:\\code\\WorkSpace\\mindundisloyalty\\node_modules\\eslint-loader\\dist\\cjs.js!F:\\code\\WorkSpace\\mindundisloyalty\\src\\main\\webapp\\app\\core\\auth\\account.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, Subject, of } from 'rxjs';\nimport { shareReplay, tap, catchError } from 'rxjs/operators';\n\nimport { SERVER_API_URL } from 'app/app.constants';\nimport { Account } from 'app/core/user/account.model';\n\n@Injectable({ providedIn: 'root' })\nexport class AccountService {\n  private userIdentity: Account;\n  private authenticated = false;\n  private authenticationState = new Subject<any>();\n  private accountCache$: Observable<Account>;\n\n  constructor(private http: HttpClient) {}\n\n  fetch(): Observable<Account> {\n    return this.http.get<Account>(SERVER_API_URL + 'api/account');\n  }\n\n  save(account: Account): Observable<Account> {\n    return this.http.post<Account>(SERVER_API_URL + 'api/account', account);\n  }\n\n  authenticate(identity) {\n    this.userIdentity = identity;\n    this.authenticated = identity !== null;\n    this.authenticationState.next(this.userIdentity);\n  }\n\n  hasAnyAuthority(authorities: string[] | string): boolean {\n    if (!this.authenticated || !this.userIdentity || !this.userIdentity.authorities) {\n      return false;\n    }\n\n    if (!Array.isArray(authorities)) {\n      authorities = [authorities];\n    }\n\n    return authorities.some((authority: string) => this.userIdentity.authorities.includes(authority));\n  }\n\n  identity(force?: boolean): Observable<Account> {\n    if (force || !this.authenticated) {\n      this.accountCache$ = null;\n    }\n\n    if (!this.accountCache$) {\n      this.accountCache$ = this.fetch().pipe(\n        catchError(() => {\n          return of(null);\n        }),\n        tap(account => {\n          if (account) {\n            this.userIdentity = account;\n            this.authenticated = true;\n          } else {\n            this.userIdentity = null;\n            this.authenticated = false;\n          }\n          this.authenticationState.next(this.userIdentity);\n        }),\n        shareReplay()\n      );\n    }\n    return this.accountCache$;\n  }\n\n  isAuthenticated(): boolean {\n    return this.authenticated;\n  }\n\n  isIdentityResolved(): boolean {\n    return this.userIdentity !== undefined;\n  }\n\n  getAuthenticationState(): Observable<any> {\n    return this.authenticationState.asObservable();\n  }\n\n  getImageUrl(): string {\n    return this.isIdentityResolved() ? this.userIdentity.imageUrl : null;\n  }\n}\n"]}]}